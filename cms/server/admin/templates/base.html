{% from "fragments/reevaluation_buttons.html" import ReevaluationButtons with context %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="{{ url("static", "favicon.ico") }}" />
    <link rel="stylesheet" type="text/css" href="{{ url("static", "bootstrap.min.css") }}">
    <link rel="stylesheet" type="text/css" href="{{ url("static", "style.css") }}">
    <script src="{{ url("static", "web_rpc.js") }}"></script>
    <script src="{{ url("static", "aws_utils.js") }}"></script>
    <script src="{{ url("static", "jq", "jquery-1.7.1.min.js") }}"></script>
    <script src="{{ url("static", "jq", "jquery.jqplot.min.js") }}"></script>
    <script src="{{ url("static", "jq", "jqplot.dateAxisRenderer.min.js") }}"></script>
    <script src="{{ url("static", "jq", "jqplot.enhancedLegendRenderer.min.js") }}"></script>
    <script src="{{ url("static", "sh", "shCore.js") }}"></script>
    <script src="{{ url("static", "sh", "shBrushCpp.js") }}"></script>
    <script src="{{ url("static", "sh", "shBrushDelphi.js") }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ url("static", "jq", "jquery.jqplot.min.css") }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url("static", "sh", "shCore.css") }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url("static", "sh", "shThemeDefault.css") }}"/>

    {% if contest is none %}
      <title>Admin</title>
    {% else %}
      <title>Admin: {{ contest.description }}</title>
    {% endif %}

    <script>
<!--
function init()
{
    {% if contest is none %}
    utils = new CMS.AWSUtils("{{ url() }}", {{ timestamp|make_timestamp }}, 0, 0, 0, 0, -1);
    utils.update_notifications();
    setInterval(function() { utils.update_notifications(); }, 15000);
    {% else %}
    utils = new CMS.AWSUtils("{{ url() }}", {{ timestamp|make_timestamp }},
        {{ contest.start|make_timestamp }}, {{ contest.stop|make_timestamp }},
        {{ contest.analysis_start|make_timestamp }}, {{ contest.analysis_stop|make_timestamp }},
        {{ phase }});

    {% if phase < 3 %}
    utils.update_remaining_time();
    setInterval(function() { utils.update_remaining_time(); }, 1000);
    {% endif %}
    utils.update_notifications();
    setInterval(function() { utils.update_notifications(); }, 15000);
    {% endif %}

    $(document).click(utils.hide_subpage);

    // delegate() ensures that the event is fired even for elements
    // that are added in the future.
    $(document).delegate('.toggling_on', 'click', utils.toggle_visibility);
    $(document).delegate('.toggling_off', 'click', utils.toggle_visibility);

    {% block js_init %}{% endblock js_init %}
}

{% block js %}{% endblock js %}

$(document).ready(init);

//-->
    </script>
  </head>
  <body class="container-fluid">
    <div class="wrapper">
      <nav id="sidebar">
        {% if admin is undefined %}

          <h1>Administration</h1>

        {% else %}
          <div class="mt-1">
            <form action="{{ url("logout") }}" method="POST">
              Hello, <a href="{{ url("admins") }}">{{ admin.name }}</a>.
              {{ xsrf_form_html|safe }}
              <input class="btn btn-sm btn-outline-secondary" type="submit" value="Logout">
            </form>
          </div>


          {% if contest is none %}
            <h1>Administration</h1>
          {% else %}
            <h1><a href="{{ url() }}">Administration</a></h1>
            <h2>{{ contest.name }}</h2>
          {% endif %}


          {% if config.secret_key == config.secret_key_default %}
            <div class="alert alert-danger p-2 change-secret">
              Change secret_key in cms.conf! For example,
              <pre class="mb-0">{{ get_hex_random_key() }}</pre>
            </div>
          {% endif %}


          <ul>
            {% if contest is none %}
              <li><a href="{{ url() }}">Overview</a></li>
              <li><a href="{{ url("resourceslist") }}">Resource usage</a></li>
            {% else %}
              <li><a href="{{ url("contest", contest.id, "overview") }}">Overview</a></li>
              <li><a href="{{ url("contest", contest.id, "resourceslist") }}">Resource usage</a></li>
            {% endif %}
          </ul>


          {% if contest is none %}
            <h2><a href="{{ url("contests") }}">Contests</a></h2>
            <ul>
              {% if contest_list|length == 0 %}
                <li>
                  (no contests available)
                </li>
              {% endif %}

              {% for c in contest_list[:5] %}
                <li>
                  <a href="{{ url("contest", c.id) }}" title="{{ c.description }}">
                    {{ c.name }}
                  </a>
                </li>
              {% endfor %}

              {% if contest_list|length > 5 %}
                <li>
                  <a href="{{ url("contests") }}">
                    (show more...)
                  </a>
                </li>
              {% endif %}

              {% if admin.permission_all %}
                <li>
                  <a href="{{ url("contests", "add") }}">
                    (create new contest...)
                  </a>
                </li>
              {% endif %}
            </ul>


            <h2><a href="{{ url("tasks") }}">Tasks</a></h2>
            <ul>
              {% if task_list|length == 0 %}
                <li>
                  (no tasks available)
                </li>
              {% endif %}

              {% for t in task_list[:5] %}
                <li>
                  <a href="{{ url("task", t.id) }}" title="{{ t.title }}">
                    {{ t.name }}
                  </a>
                </li>
              {% endfor %}

              {% if task_list|length > 5 %}
                <li>
                  <a href="{{ url("tasks") }}">
                    (show more...)
                  </a>
                </li>
              {% endif %}

              {% if admin.permission_all %}
                <li>
                  <a href="{{ url("tasks", "add") }}">
                    (create new task...)
                  </a>
                </li>
              {% endif %}
            </ul>


            <h1><a href="{{ url("users") }}">Users</a></h1>
            <ul>
              {% if user_list|length == 0 %}
                <li>
                  (no user available)
                </li>
              {% else %}
                <li>
                  <a href="{{ url("users") }}">
                    {% if user_list|length == 1 %}
                      (show the only user...)
                    {% else %}
                      (show the {{ user_list|length }} users...)
                    {% endif %}
                  </a>
                </li>
              {% endif %}

              {% if admin.permission_all %}
                <li>
                  <a href="{{ url("users", "add") }}">
                    (create new user...)
                  </a>
                </li>
              {% endif %}
            </ul>


            <h1><a href="{{ url("teams") }}">Teams</a></h1>
            <ul>
              {% if team_list|length == 0 %}
                <li>
                  (no team available)
                </li>
              {% else %}
                <li>
                  <a href="{{ url("teams") }}">
                    {% if team_list|length == 1 %}
                      (show the only team...)
                    {% else %}
                      (show the {{ team_list|length }} teams...)
                    {% endif %}
                  </a>
                </li>
              {% endif %}

              {% if admin.permission_all %}
                <li>
                  <a href="{{ url("teams", "add") }}">
                    (create new team...)
                  </a>
                </li>
              {% endif %}
            </ul>


          {% else %}


            <ul>
              <li><a href="{{ url("contest", contest.id) }}">General</a></li>
              <li><a href="{{ url("contest", contest.id, "ranking") }}">Ranking</a></li>
              <li><a href="{{ url("contest", contest.id, "submissions") }}">Submissions</a></li>
              {% if contest.allow_user_tests %}
                <li><a href="{{ url("contest", contest.id, "user_tests") }}">User tests</a></li>
              {% endif %}
              <li><a href="{{ url("contest", contest.id, "users") }}">Users</a></li>
              <li><a href="{{ url("contest", contest.id, "tasks") }}">Tasks</a></li>
              <li><a href="{{ url("contest", contest.id, "announcements") }}">Announcements</a></li>
              <li><a href="{{ url("contest", contest.id, "questions") }}">Questions</a></li>
            </ul>

            <div id="unanswered_questions" class="unread alert alert-danger"
              {% if unanswered == 0 %} style="display: none;" {% endif %}>
              <a href="{{ url("contest", contest.id, "questions") }}">
              {% if unanswered == 1 %}
                One unanswered question.
              {% else %}
                {{ unanswered }} unanswered questions.
              {% endif %}
              </a>
            </div>

            <div>
              <span id="remaining_text"></span>
              <span id="remaining_value"></span>
            </div>
          {% endif %}
        {% endif %}

        <hr />

        <div class="cr_notice">
          CMS <a href="http://github.com/cms-dev/cms/">codebase</a> is released under the
          <a href="http://www.gnu.org/licenses/agpl.txt">GNU Affero General Public License</a>.</div>
      </nav>
      <div id="content" class="container-fluid pt-2 pb-2">
        <span id="notifications" class="notifications"></span>
        {% block core %}{% endblock core %}

        <div id="subpage" onclick="var event = arguments[0] || window.event; event.stopPropagation()">
          <div id="subpage_border"></div>
          <div id="subpage_background"></div>
          <div id="subpage_content"></div>
        </div>
      </div>
    </div>
  </body>
</html>
