{% extends "base.html" %}

{% block core %}
<h1 class="display-4">Contest configuration</h1>

{% include "fragments/overload_warning.html" %}

<!-- We use "multipart/form-data" to have Tornado distinguish between missing and empty values. -->
<form enctype="multipart/form-data" action="{{ url("contest", contest.id) }}" method="POST"
      name="edit_contest" class="edit-form">
  {{ xsrf_form_html|safe }}

  <h2 class="mt-4">Contest information</h2>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Name
        <span class="help-text">A short name for the contest, preferably using only letters, numbers and underscores.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="name" value="{{ contest.name }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Description
        <span class="help-text">The name of the contest as seen by the contestants.</span>
      </span>
    </label>
    <div class="col-md-9">
      <textarea class="form-control" name="description">{{ contest.description }}</textarea>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Allowed localizations
        <span class="help-text">The list of languages that contestants can use, or empty for allowing any language.
                              Example: 'en,ja' (without quotes).</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="allowed_localizations" value="{{ contest.allowed_localizations|join(",") }}"/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3">
      <span class="help">
        Allowed programming languages
        <span class="help-text">Programming languages that contestants can use to solve the tasks.
                              All the allowed languages must have task support, for example in managed tasks.</span>
      </span>
    </label>
    <div class="col-md-9">
      {% for lang in LANGUAGES %}
          <label class="language">
            <input type="checkbox" name="languages" value="{{ lang.name }}" {{ "checked" if lang.name in contest.languages else "" }}>
            {{ lang.name }}
          </label>
        {% endfor %}
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3" for="submissions_download_allowed">
      <span class="help">
        Submissions download allowed
        <span class="help-text">Whether contestants can download their own submissions.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="submissions_download_allowed" name="submissions_download_allowed" {{ "checked" if contest.submissions_download_allowed else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3" for="allow_questions">
      <span class="help">
        Allow questions
        <span class="help-text">Whether contestants can submit questions.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="allow_questions" name="allow_questions" {{ "checked" if contest.allow_questions else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3" for="allow_user_tests">
      <span class="help">
        Allow user tests
        <span class="help-text">Whether contestants can submit user tests.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="allow_user_tests" name="allow_user_tests" {{ "checked" if contest.allow_user_tests else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Score decimal places
        <span class="help-text">The number of decimal places the scores will be rounded to.
                              Example: '2' to allow 98.76.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="score_precision" value="{{ contest.score_precision }}">
    </div>
  </div>


  <h2 class="mt-4">Logging in</h2>

  <div class="form-group row">
    <label class="col-md-3" for="block_hidden_participations">
      <span class="help">
        Block hidden participations
        <span class="help-text">If checked, contestants that are marked as hidden in this contest will not be able to log in.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="block_hidden_participations" name="block_hidden_participations" {{ "checked" if contest.block_hidden_participations else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3" for="allow_password_authentication">
      <span class="help">
        Allow password authentication
        <span class="help-text">If checked, contestants will be able to log in using username and password.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="allow_password_authentication" name="allow_password_authentication" {{ "checked" if contest.allow_password_authentication else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3" for="ip_restriction">
      <span class="help">
        IP based login restriction
        <span class="help-text">If true, contestants with an IP address specified for this contest will only be able to log in from that address.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="ip_restriction" name="ip_restriction" {{ "checked" if contest.ip_restriction else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3" for="ip_autologin">
      <span class="help">
        IP based autologin
        <span class="help-text">If true, contestants with an IP address specified for this contest will be automatically logged in when connecting from that address.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="ip_autologin" name="ip_autologin" {{ "checked" if contest.ip_autologin else "" }}/>
    </div>
  </div>


  <h2 class="mt-4">
    Tokens parameters (<a href="http://cms.readthedocs.org/en/{{ rtd_version }}/Configuring%20a%20contest.html#feedback-to-contestants" target="_blank">documentation</a>)
  </h2>

  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Token mode
        <span class="help-text">Select 'disabled' to remove tokens completely, 'infinite' for allowing any number of tokens, or 'finite' to specify the amount with the following parameters.
                              If you prefer to control tokens at the task level, select 'infinite' here.</span>
      </span>
    </label>
    <div class="col-md-9">
      <select name="token_mode" class="form-control">
        <option value="disabled" {{ "selected" if contest.token_mode == "disabled" else "" }}>Disabled</option>
        <option value="finite" {{ "selected" if contest.token_mode == "finite" else "" }}>Finite</option>
        <option value="infinite" {{ "selected" if contest.token_mode == "infinite" else "" }}>Infinite</option>
      </select>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Maximum number of tokens
        <span class="help-text">The maximum number of tokens a contestant can use in the whole contest.
                              It is used only if tokens are finite.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="token_max_number" value="{{ contest.token_max_number if contest.token_max_number is not none else "" }}" size="3">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Minimum interval between tokens
        <span class="help-text">The minimum amount of time (in seconds) that a contestant needs to wait after using a token before being able to use another.
                              It is used only if tokens are finite.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="token_min_interval" value="{{ contest.token_min_interval.total_seconds()|int }}" size="3">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Initial number of tokens
        <span class="help-text">The number of tokens that a contestant has available when their contest time starts.
                              It is used only if tokens are finite.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="token_gen_initial" value="{{ contest.token_gen_initial }}" size="3">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Token generation number
        <span class="help-text">The number of tokens that are generated periodically.
                              It is used only if tokens are finite.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="token_gen_number" value="{{ contest.token_gen_number }}" size="3">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Token generation period
        <span class="help-text">The amount of time (in minutes) between two token generation events.
                              It is used only if tokens are finite.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="token_gen_interval" value="{{ contest.token_gen_interval.total_seconds()|int // 60 }}" size="3">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Maximum accumulated tokens
        <span class="help-text">Maximum number of tokens available to a contestant at any given time during the contest.
                              It is used only if tokens are finite.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="token_gen_max" value="{{ contest.token_gen_max if contest.token_gen_max is not none else "" }}" size="3">
    </div>
  </div>


  <h2 class="mt-4">Times</h2>

  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Start time (in UTC)
        <span class="help-text">Start time of the contest in the UTC timezone.
                              Example: '2015-12-31 15:00:00'.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="start" value="{{ contest.start }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        End time (in UTC)
        <span class="help-text">End time of the contest in the UTC timezone.
                              Example: '2015-12-31 18:00:00'.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="stop" value="{{ contest.stop }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Timezone
        <span class="help-text">Timezone of the server, used to display start, end times and the current server time to contestants.
                              Example: 'Europe/Rome', 'America/New_York', ...</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="timezone" value="{{ contest.timezone if contest.timezone is not none else "" }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Length of the contest
        <span class="help-text">Length of the contest (in seconds) for each contestant.
                              If not specified, each contestant can submit solutions for the whole duration of the contest.
                              If specified, only up to this length after the first log in (or up to the end of the contest, whichever comes first).</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="per_user_time" value="{{ contest.per_user_time.total_seconds()|int if contest.per_user_time is not none else "" }}">
    </div>
  </div>


  <h2 class="mt-4">Limits</h2>

  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Maximum number of submissions
        <span class="help-text">Maximum number of submissions each contestant can submit, for the whole contest.
                              Leave empty for no limits.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="max_submission_number" value="{{ contest.max_submission_number if contest.max_submission_number is not none else "" }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Maximum number of user tests
        <span class="help-text">Maximum number of user tests each contestant can submit, for the whole contest.
                              Leave empty for no limits.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="max_user_test_number" value="{{ contest.max_user_test_number if contest.max_user_test_number is not none else "" }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Minimum interval between submissions
        <span class="help-text">The minimum amount of time (in seconds) that a contestant needs to wait after a submission before being able to submit another.
                              Leave empty for no limits.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="min_submission_interval" value="{{ contest.min_submission_interval.total_seconds()|int if contest.min_submission_interval is not none else "" }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Minimum interval between user tests
        <span class="help-text">The minimum amount of time (in seconds) that a contestant needs to wait after a user test before being able to send another.
                              Leave empty for no limits.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="min_user_test_interval" value="{{ contest.min_user_test_interval.total_seconds()|int if contest.min_user_test_interval is not none else "" }}">
    </div>
  </div>


  <h2 class="mt-4">Analysis mode</h2>

  <div class="form-group row">
    <label class="col-md-3" for="analysis_enabled">
      <span class="help">
        Enabled
        <span class="help-text">If true, analysis mode for this contest will be enabled.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input type="checkbox" id="analysis_enabled" name="analysis_enabled" {{ "checked" if contest.analysis_enabled else "" }}/>
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Analysis mode start time (in UTC)
        <span class="help-text">Start time of the analysis mode in the UTC timezone.
                              Example: '2015-12-31 15:00:00'.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="analysis_start" value="{{ contest.analysis_start }}">
    </div>
  </div>
  <div class="form-group row">
    <label class="col-md-3 col-form-label">
      <span class="help">
        Analysis mode end time (in UTC)
        <span class="help-text">End time of the analysis mode in the UTC timezone.
                              Example: '2015-12-31 18:00:00'.</span>
      </span>
    </label>
    <div class="col-md-9">
      <input class="form-control" type="text" name="analysis_stop" value="{{ contest.analysis_stop }}">
    </div>
  </div>

  <input type="submit"
         value="Update"
         class="btn btn-success mb-4"
         {% if not admin.permission_all %}
           disabled
         {% endif %}
         >
  <input type="reset" value="Reset" class="btn btn-warning mb-4">
</form>

<form action="{{ url("contests") }}" method="POST">
  {{ xsrf_form_html|safe }}
  <input type="hidden" name="contest_id" value="{{ contest.id }}"/>
  <input type="submit"
         name="operation"
         class="btn btn-danger mb-4"
         value="Remove"
         {% if not admin.permission_all %}
           disabled
         {% endif %}
         />
</form>


{% endblock core %}
